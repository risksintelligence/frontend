"use client";

import StatusBadge from "@/components/ui/StatusBadge";

interface SectorVulnerabilityTableProps {
  sectors?: Array<{
    sector: string;
    vulnerability: number;
    lead_time_days?: number;
    alt_sources?: number;
    notes?: string;
  }>;
  recommendations?: Array<{
    sector: string;
    action: string;
    expected_lead_time_delta?: number;
  }>;
}

export default function SectorVulnerabilityTable({ sectors, recommendations }: SectorVulnerabilityTableProps) {
  if (!sectors || sectors.length === 0) {
    return (
      <div className="terminal-card p-4">
        <p className="text-sm text-terminal-muted font-mono">No sector vulnerabilities available.</p>
      </div>
    );
  }

  const riskVariant = (vuln: number): "critical" | "warning" | "good" =>
    vuln >= 0.6 ? "critical" : vuln >= 0.4 ? "warning" : "good";

  return (
    <div className="terminal-card p-4 space-y-3">
      <div className="flex items-center justify-between">
        <div>
          <p className="text-xs uppercase tracking-wide text-terminal-muted">Sector Vulnerabilities</p>
          <h4 className="text-sm font-semibold text-terminal-text">Sector-Specific Risk Assessment</h4>
        </div>
      </div>
      <div className="space-y-2">
        {sectors.map((s) => (
          <div key={s.sector} className="border border-terminal-border rounded p-3">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <span className="font-mono text-sm text-terminal-text uppercase">{s.sector}</span>
                <StatusBadge variant={riskVariant(s.vulnerability)}>
                  {(s.vulnerability * 100).toFixed(0)}%
                </StatusBadge>
              </div>
              <span className="text-xs font-mono text-terminal-muted">
                Lead time: {s.lead_time_days?.toFixed(1) ?? "n/a"}d · Alt sources: {s.alt_sources ?? "n/a"}
              </span>
            </div>
            {s.notes && <p className="text-xs text-terminal-muted font-mono mt-1">{s.notes}</p>}
          </div>
        ))}
      </div>
      {recommendations && recommendations.length > 0 && (
        <div className="mt-2">
          <p className="text-xs uppercase tracking-wide text-terminal-muted">Recommendations</p>
          <div className="space-y-1">
            {recommendations.map((r) => (
              <div key={`${r.sector}-${r.action}`} className="text-xs font-mono text-terminal-text border border-terminal-border rounded p-2">
                <span className="font-semibold">{r.sector.toUpperCase()}:</span> {r.action}
                {r.expected_lead_time_delta !== undefined && (
                  <span className="text-terminal-muted"> (lead time Δ {r.expected_lead_time_delta.toFixed(1)}d)</span>
                )}
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
